<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <title th:text="${book.title} + ' | 북스캠프'">도서 상세</title>
</head>

<body>
<section layout:fragment="hero" class="hero" style="display: none;">
</section>

<div layout:fragment="content">
    <section class="product-details spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-md-6">
                    <div class="product__details__pic">
                        <div th:if="${book.imageUrls != null and !book.imageUrls.isEmpty()}">
                            <div class="product__details__pic__slider owl-carousel">
                                <div class="product__details__pic__item" th:each="imgUrl : ${book.imageUrls}">
                                    <img th:src="${imgUrl}" alt="도서 이미지">
                                </div>
                            </div>
                        </div>

                        <div class="product__details__pic__item"
                             th:if="${book.imageUrls == null or book.imageUrls.isEmpty()}">
                            <div style="width: 100%; height: 500px; background: #f8f8f8; display: flex; align-items: center; justify-content: center; border: 1px solid #ebebeb; border-radius: 4px;">
                                <i class="fa fa-book" style="font-size: 80px; color: #ccc;"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6">
                    <div class="product__details__text">
                        <h3 th:text="${book.title}" style="margin-bottom: 20px; font-weight: 700; color: #333;">도서 제목</h3>

                        <div style="padding: 20px 0; border-top: 1px solid #ebebeb; border-bottom: 1px solid #ebebeb; margin-bottom: 20px;">
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                <li style="padding: 8px 0; display: flex;">
                                    <span style="width: 100px; color: #6f6f6f; font-weight: 600;">출판사</span>
                                    <span th:text="${book.publisher}" style="color: #333;">출판사</span>
                                </li>
                                <li style="padding: 8px 0; display: flex;">
                                    <span style="width: 100px; color: #6f6f6f; font-weight: 600;">출판일</span>
                                    <span th:text="${#temporals.format(book.publishDate, 'yyyy-MM-dd')}" style="color: #333;">2025-01-01</span>
                                </li>
                                <li style="padding: 8px 0; display: flex;">
                                    <span style="width: 100px; color: #6f6f6f; font-weight: 600;">재고</span>
                                    <span style="color: #333;">
                                        <span th:text="${book.stock + '권'}">10권</span>
                                        </span>
                                </li>
                                <li style="padding: 8px 0; display: flex;">
                                    <span style="width: 100px; color: #6f6f6f; font-weight: 600;">포장</span>
                                    <span th:if="${book.packable}" style="color: #7fad39; font-weight: 600;">포장 가능</span>
                                    <span th:unless="${book.packable}" style="color: #999;">포장 불가능</span>
                                </li>
                                <li style="padding: 8px 0; display: flex;">
                                    <span style="width: 100px; color: #6f6f6f; font-weight: 600;">조회수</span>
                                    <span th:text="${book.viewCount}" style="color: #333;">200</span>
                                </li>
                            </ul>
                        </div>

                        <div class="product__details__price" style="margin-bottom: 30px;">
                        </div>

                        <div class="product__details__tags" style="margin-bottom: 25px;"
                             th:if="${book.tags != null and !book.tags.isEmpty()}">
                            <ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-wrap: wrap; gap: 8px;">
                                <li th:each="tag : ${book.tags}">
                                    <a th:href="@{/search(tag=${tag})}" th:text="'#' + ${tag}"
                                       style="background: #f5f5f5; color: #6f6f6f; padding: 5px 12px; border-radius: 20px; font-size: 13px; font-weight: 600; display: inline-block; transition: all 0.3s;">
                                        #Tag
                                    </a>
                                </li>
                            </ul>
                        </div>


                        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        </div>
                        <div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row" style="margin-top: 60px;">
            </div>
        </div>
    </section>
</div>

<th:block layout:fragment="extra-css">
    <style>
        /* 이미지 슬라이더 아이템 스타일 */
        .product__details__pic__slider .product__details__pic__item img {
            width: 100%;
            height: 500px; /* placeholder와 높이 통일 */
            object-fit: contain; /* 이미지가 잘리거나 찌그러지지 않게 설정 */
            border: 1px solid #ebebeb;
            border-radius: 4px;
        }

        /* 캐러셀 좌/우 화살표 스타일 (테마 기본값 사용) */
        .product__details__pic__slider .owl-nav {
            position: absolute;
            top: 50%;
            width: 100%;
            transform: translateY(-50%);
        }
        .product__details__pic__slider .owl-nav button {
            position: absolute;
            background: rgba(255, 255, 255, 0.8) !important;
            color: #333 !important;
            width: 40px;
            height: 40px;
            border-radius: 50% !important;
            font-size: 20px !important;
            line-height: 40px !important;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        .product__details__pic__slider .owl-nav button:hover {
            background: #7fad39 !important;
            color: white !important;
        }
        .product__details__pic__slider .owl-nav button.owl-prev {
            left: -20px; /* 위치 조정 */
        }
        .product__details__pic__slider .owl-nav button.owl-next {
            right: -20px; /* 위치 조정 */
        }

        /* 태그 호버 효과 */
        .product__details__tags a:hover {
            background: #7fad39;
            color: white;
        }

        /* (기존 좋아요 버튼 스타일) */
        #likeButton.liked {
            background: #dc3545 !important;
            color: white !important;
            border-color: #dc3545 !important;
        }
        #likeButton.liked .icon-unliked {
            display: none;
        }
        #likeButton.liked .icon-liked {
            display: inline-block !important;
        }
        #likeButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
    </style>
</th:block>

<th:block layout:fragment="extra-js">
    <script th:inline="javascript">
        /*<![CDATA[*/

        // (기존 좋아요 스크립트)
        const pathPrefix = /*[[${apiPrefix}]]*/ '';

        document.addEventListener("DOMContentLoaded", function() {

            // [추가] 이미지 슬라이더(캐러셀) 초기화
            $(".product__details__pic__slider").owlCarousel({
                items: 1,         // 한 번에 1개만 표시
                loop: true,       // 무한 반복
                nav: true,        // 좌/우 화살표
                dots: false,      // 하단 점 (false로 숨김)
                autoplay: true,   // 자동 스크롤
                autoplayTimeout: 5000, // 5초마다
                autoplayHoverPause: true
            });

            // (기존 좋아요 스크립트... 동일)
            const likeButton = document.getElementById('likeButton');
            if (likeButton) { // likeButton이 페이지에 있을 때만 실행
                const likeCountElement = document.getElementById('likeCount');
                const bookId = [[${book.id}]];
                const isAlreadyLiked = [[${isLikedByCurrentUser}]];
                const apiUrl = pathPrefix + '/api-server/books/like';

                let currentLikeCount = parseInt(likeCountElement.innerText, 10);

                if (isAlreadyLiked) {
                    likeButton.classList.add('liked');
                }

                likeButton.addEventListener('click', function() {
                    // ... (이하 좋아요 fetch 로직 동일) ...
                });
            }
        });

        /*]]>*/
    </script>
</th:block>
</body>
</html>