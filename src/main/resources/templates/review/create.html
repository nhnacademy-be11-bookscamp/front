<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <meta charset="UTF-8">
    <title>Î¶¨Î∑∞ ÏûëÏÑ± | Î∂ÅÏä§Ï∫†ÌîÑ</title>

    <style>
        body {
            background: #f8f9fa;
        }

        .review-box {
            background: #fff;
            padding: 30px;
            border: 1px solid #ebebeb;
            border-radius: 8px;
            margin-top: 35px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.04);
        }

        /* ‚≠ê Î≥ÑÏ†ê Ïä§ÌÉÄÏùº */
        .stars .star {
            font-size: 32px;
            color: #ccc;
            cursor: pointer;
            transition: color 0.2s;
        }

        .stars .star.selected {
            color: #ffcc00;
        }

        .stars .star:hover {
            color: #ffdd55;
        }

        /* Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ */
        .img-preview-box {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 10px;
        }

        .img-preview-box img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

    </style>
</head>

<body>

<!-- üö´ Î∞∞ÎÑà Ï†úÍ±∞ -->
<section layout:fragment="hero" style="display:none;"></section>

<!-- üö´ ÏÇ¨Ïù¥ÎìúÎ∞î Ï†úÍ±∞, Î¶¨Î∑∞ ÏòÅÏó≠ Ï§ëÏïô Ï†ïÎ†¨ -->
<section layout:fragment="content">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 review-box">

                <h4 style="font-weight:700; margin-bottom:25px;">Î¶¨Î∑∞ ÏûëÏÑ±</h4>

                <form th:action="@{/mypage/reviews}" method="post" enctype="multipart/form-data">

                    <!-- Ï£ºÎ¨∏ ÏÉÅÌíà ID -->
                    <input type="hidden" name="orderItemId" th:value="${orderItemId}">

                    <!-- ‚≠ê ÌèâÏ†ê -->
                    <div style="margin-bottom:20px;">
                        <label style="font-weight:600;">ÌèâÏ†ê</label>
                        <div class="stars">
                            <i class="fa fa-star star" data-value="1"></i>
                            <i class="fa fa-star star" data-value="2"></i>
                            <i class="fa fa-star star" data-value="3"></i>
                            <i class="fa fa-star star" data-value="4"></i>
                            <i class="fa fa-star star" data-value="5"></i>
                        </div>
                        <input type="hidden" name="score" id="scoreInput" value="5">
                    </div>

                    <!-- ÎÇ¥Ïö© -->
                    <div style="margin-bottom:20px;">
                        <label style="font-weight:600;">Î¶¨Î∑∞ ÎÇ¥Ïö©</label>
                        <textarea name="content"
                                  style="width:100%; height:140px; border:1px solid #ccc; padding:12px; border-radius:4px;"
                                  placeholder="Î¶¨Î∑∞ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."></textarea>
                    </div>

                    <!-- Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú -->
                    <div style="margin-bottom:20px;">
                        <label style="font-weight:600;">Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú</label>
                        <input type="file" id="imageUpload" name="files" multiple accept="image/*">
                        <div id="previewBox" class="img-preview-box"></div>
                    </div>

                    <button type="submit" class="site-btn"
                            style="width:100%; margin-top:15px; padding:12px; font-size:16px;">
                        Î¶¨Î∑∞ Îì±Î°ùÌïòÍ∏∞
                    </button>

                </form>

            </div>
        </div>
    </div>
</section>

<!-- ‚≠ê Î≥ÑÏ†ê + Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ Ïä§ÌÅ¨Î¶ΩÌä∏ -->
<th:block layout:fragment="extra-js">
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            /* ‚≠ê Î≥ÑÏ†ê ÏÑ†ÌÉù */
            const stars = document.querySelectorAll(".star");
            const scoreInput = document.getElementById("scoreInput");

            let currentScore = 5;

            // Í∏∞Î≥∏ 5Í∞ú Ïπ†ÌïòÍ∏∞
            stars.forEach(s => {
                if (s.dataset.value <= currentScore) {
                    s.classList.add("selected");
                }
            });

            stars.forEach(star => {
                star.addEventListener("click", function () {
                    const rating = this.dataset.value;
                    scoreInput.value = rating;

                    stars.forEach(s => {
                        s.classList.remove("selected");
                        if (s.dataset.value <= rating) s.classList.add("selected");
                    });
                });
            });

            /* üñº Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ */
            const fileInput = document.getElementById("imageUpload");
            const preview = document.getElementById("previewBox");

            fileInput.addEventListener("change", function () {
                preview.innerHTML = "";

                Array.from(this.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = e => {
                        const img = document.createElement("img");
                        img.src = e.target.result;
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });
            });

        });
    </script>
</th:block>

</body>
</html>
