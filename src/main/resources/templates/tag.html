<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/no-sidebar}">
<head>
    <title>태그 관리</title>
</head>
<body>
<div layout:fragment="content" style="padding: 2rem;">

    <h1>태그 관리</h1>
    <p>관리자용 태그 관리 페이지입니다.</p>

    <!-- 태그 추가 폼 -->
    <form id="tagForm" style="margin-top: 1.5rem;">
        <input type="text" id="tagName" placeholder="새 태그 이름을 입력하세요" required
               style="padding: 0.5rem; width: 250px;">
        <button type="submit" style="padding: 0.5rem 1rem;">추가</button>
    </form>

    <!-- 태그 목록 테이블 -->
    <table id="tagTable" border="1" style="border-collapse: collapse; margin-top: 2rem; width: 400px;">
        <thead>
        <tr style="background-color: #f2f2f2;">
            <th>ID</th>
            <th>태그 이름</th>
            <th>삭제</th>
        </tr>
        </thead>
        <tbody>
        <!-- 태그 목록이 여기에 동적으로 추가됩니다 -->
        </tbody>
    </table>

    <script>
        const apiBase = '/admin/tags'; // 백엔드 TagController 매핑 주소

        // 페이지 로드 시 전체 태그 불러오기
        document.addEventListener('DOMContentLoaded', loadTags);

        // 태그 목록 로드
        function loadTags() {
            fetch(apiBase)
                .then(response => response.json())
                .then(tags => {
                    const tbody = document.querySelector('#tagTable tbody');
                    tbody.innerHTML = ''; // 기존 데이터 초기화
                    tags.forEach(tag => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${tag.id}</td>
                            <td>${tag.name}</td>
                            <td><button onclick="deleteTag(${tag.id})">삭제</button></td>
                        `;
                        tbody.appendChild(row);
                    });
                })
                .catch(err => console.error('태그 목록 로드 실패:', err));
        }

        // 태그 추가
        document.getElementById('tagForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const name = document.getElementById('tagName').value.trim();
            if (!name) return;

            fetch(apiBase, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name })
            })
                .then(response => {
                    if (!response.ok) throw new Error('태그 추가 실패');
                    return response.json();
                })
                .then(() => {
                    document.getElementById('tagName').value = '';
                    loadTags(); // 목록 갱신
                })
                .catch(err => console.error(err));
        });

        // 태그 삭제
        function deleteTag(id) {
            if (!confirm('정말 삭제하시겠습니까?')) return;

            fetch(`${apiBase}/${id}`, { method: 'DELETE' })
                .then(response => {
                    if (!response.ok) throw new Error('삭제 실패');
                    loadTags();
                })
                .catch(err => console.error(err));
        }
    </script>
</div>
</body>
</html>
