<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <title>북스캠프 | 주문 내역</title>

    <!-- 주문 내역 전용 스타일 -->
    <th:block layout:fragment="extra-css">
        <style>
            .order-history-title {
                font-size: 1.5rem;
                font-weight: 700;
                margin-bottom: 1rem;
            }
            .order-history-subtitle {
                color: #6c757d;
                margin-bottom: 1.5rem;
            }
            .order-table th, .order-table td {
                vertical-align: middle;
                font-size: 0.95rem;
            }
            .order-empty {
                padding: 3rem 0;
                text-align: center;
                color: #6c757d;
                font-size: 1rem;
            }
            /* === 컬럼 폭/줄바꿈 문제 해결 === */
            /* 주문일 */
            .order-table th:nth-child(1),
            .order-table td:nth-child(1) {
                width: 115px;          /* 날짜가 한 줄에 들어올 최소 폭 */
                white-space: nowrap;   /* 2025-11-24가 줄바꿈되지 않게 */
            }

            /* 결제금액 */
            .order-table th:nth-child(4),
            .order-table td:nth-child(4) {
                width: 130px;          /* "33,000원"이 한 줄에 들어올 폭 */
                white-space: nowrap;   /* 숫자/원 단위 줄바꿈 방지 */
                text-align: right;
            }
        </style>
    </th:block>
</head>

<body>

<!-- Hero 영역: 간단한 타이틀/크럼브로 대체 -->
<section class="hero" layout:fragment="hero">
    <div class="container py-3">
        <div class="row">
            <div class="col-12">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-1">
                        <li class="breadcrumb-item"><a th:href="@{/}">홈</a></li>
                        <li class="breadcrumb-item active" aria-current="page">주문 내역</li>
                    </ol>
                </nav>
                <h2 class="fw-bold">주문 내역</h2>
                <p class="text-muted mb-0">회원님이 주문하신 내역을 확인할 수 있습니다.</p>
            </div>
        </div>
    </div>
</section>

<!-- 메인 콘텐츠 영역 -->
<div layout:fragment="content">
    <div class="container my-4">
        <!-- 주문 내역이 없는 경우 -->
        <div th:if="${orders == null or #lists.isEmpty(orders)}" class="order-empty">
            주문 내역이 없습니다.
        </div>

        <!-- 주문 내역이 있는 경우 -->
        <div th:if="${orders != null and !#lists.isEmpty(orders)}" class="card shadow-sm">
            <div class="card-body">
                <h3 class="order-history-title">주문 내역</h3>
                <p class="order-history-subtitle">최근 주문부터 순서대로 표시됩니다.</p>

                <div class="table-responsive">
                    <table class="table table-hover order-table">
                        <thead class="table-light">
                        <tr>
                            <th scope="col">주문일</th>
                            <th scope="col">주문번호</th>
                            <th scope="col">주문상품</th>
                            <th scope="col" class="text-end">결제금액</th>
                        </tr>
                        </thead>

                            <tbody>
                            <tr th:each="order : ${orders}">
                                <!-- 주문일 -->
                                <td th:text="${#temporals.format(order.orderDate(), 'yyyy-MM-dd')}"></td>

                                <!-- 주문번호: 클릭 시 /orders/{orderId} 이동 -->
                                <td>
                                    <a th:href="@{/orders/{orderId}(orderId=${order.orderId()})}"
                                       class="text-decoration-none text-dark"
                                       th:text="${order.orderId()}">
                                    </a>
                                </td>

                                <!-- 주문상품: 클릭 시 /orders/{orderId} 이동 -->
                                <td>
                                    <a th:href="@{/orders/{orderId}(orderId=${order.orderId()})}"
                                       class="text-decoration-none text-dark">
                                        <!-- 대표 도서명 null 안전 처리 -->
                                        <span th:text="${order.representativeBookTitle() != null ? order.representativeBookTitle() : '삭제된 도서'}"></span>
                                        <!-- 총 권수 표시 -->
                                        <span th:if="${order.totalQuantity() > 1}"
                                              th:text="${' 외 ' + (order.totalQuantity() - 1) + '권'}"></span>
                                    </a>
                                </td>

                                <!-- 결제금액 -->
                                <td class="text-end"
                                    th:text="${#numbers.formatInteger(order.finalPaymentAmount(), 3, 'COMMA')} + '원'">
                                </td>
                            </tr>
                            </tbody>

                    </table>
                </div>

                <!-- 페이징 -->
                <nav class="mt-3" th:if="${orderPage != null and orderPage.totalPages > 1}">
                    <ul class="pagination justify-content-center mb-0">

                        <!-- 이전 페이지 -->
                        <li class="page-item" th:classappend="${orderPage.first} ? 'disabled'">
                            <a class="page-link"
                               th:href="@{/orders/list(page=${currentPage - 1}, size=${pageSize})}"
                               aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>

                        <!-- 페이지 번호 -->
                        <li class="page-item"
                            th:each="p : ${#numbers.sequence(0, orderPage.totalPages - 1)}"
                            th:classappend="${p == currentPage} ? 'active'">

                        <a class="page-link"
                               th:text="${p + 1}"
                               th:href="@{/orders/list(page=${p}, size=${pageSize})}">
                            </a>
                        </li>

                        <!-- 다음 페이지 -->
                        <li class="page-item" th:classappend="${orderPage.last} ? 'disabled'">
                            <a class="page-link"
                               th:href="@{/orders/list(page=${currentPage + 1}, size=${pageSize})}"
                               aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>

                    </ul>
                </nav>


            </div>
        </div>
    </div>
</div>

<!-- 주문 내역 전용 JS 필요 시 여기에 -->
<th:block layout:fragment="extra-js">
    <!-- 현재는 별도 JS 없음 -->
</th:block>

</body>
</html>
