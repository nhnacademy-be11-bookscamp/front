<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <meta charset="UTF-8">
    <title>마이페이지 | 북스캠프</title>
</head>
<body>

<section layout:fragment="hero" class="hero" style="display:none;"></section>

<div layout:fragment="content">
    <section class="checkout spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 offset-lg-2">

                    <!-- 카드 -->
                    <div style="background:#fff; padding:24px; border:1px solid #ebebeb; border-radius:4px;">

                        <!-- 헤더 -->
                        <div style="display:flex; align-items:center; gap:8px; margin-bottom:16px; border-bottom:2px solid #ebebeb; padding-bottom:12px;">
                            <i class="fa fa-map-marker" style="color:#7fad39;"></i>
                            <h5 style="margin:0; font-weight:700; color:#333;">주소 관리</h5>
                        </div>

                        <!-- 상단 툴바 -->
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:14px;">
                            <div style="color:#6f6f6f; font-size:14px;">
                                총 <b th:text="${addresses != null ? addresses.size() : 0}">0</b>개
                            </div>
                            <a class="site-btn"
                               th:href="@{/mypage/{username}/address/new(username=${username})}"
                               style="text-decoration:none; padding:10px 14px;">
                                <i class="fa fa-plus"></i> 새 주소 추가
                            </a>
                        </div>

                        <!-- 메시지 -->
                        <div th:if="${message}"
                             style="background:#ecfeff; color:#0e7490; padding:10px 12px; border-radius:8px; margin-bottom:12px;"
                             th:text="${message}">
                        </div>

                        <!-- 빈 상태 -->
                        <div th:if="${#lists.isEmpty(addresses)}"
                             style="border:1px dashed #cfcfcf; border-radius:6px; padding:24px; text-align:center; color:#6f6f6f;">
                            등록된 주소가 없습니다. <b>‘새 주소 추가’</b>로 첫 주소를 등록하세요.
                        </div>

                        <!-- 테이블 -->
                        <div th:if="${!#lists.isEmpty(addresses)}"
                             style="border:1px solid #ebebeb; border-radius:6px; overflow:auto;">

                            <table style="width:100%; border-collapse:collapse;">
                                <thead style="background:#f8f8f8;">
                                <tr>
                                    <th style="padding:10px; border-bottom:1px solid #e5e7eb;">별칭</th>
                                    <th style="padding:10px; border-bottom:1px solid #e5e7eb;">도로명 주소</th>
                                    <th style="padding:10px; border-bottom:1px solid #e5e7eb;">우편번호</th>
                                    <th style="padding:10px; border-bottom:1px solid #e5e7eb;">기본</th>
                                    <th style="padding:10px; border-bottom:1px solid #e5e7eb;">상세 주소</th>
                                    <th style="padding:10px; border-bottom:1px solid #e5e7eb;">액션</th>
                                </tr>
                                </thead>

                                <tbody>

                                <!-- ① 기본 주소 먼저 + 회색 배경 강조 -->
                                <tr th:each="addr : ${addresses}"
                                    th:if="${addr.isDefault}"
                                    style="background:#f3f4f6; font-weight:600;">

                                    <td style="padding:10px; border-bottom:1px solid #e5e7eb;"
                                        th:text="${addr.label}"></td>

                                    <td style="padding:10px; border-bottom:1px solid #e5e7eb;"
                                        th:text="${addr.roadNameAddress}"></td>

                                    <td style="padding:10px; border-bottom:1px solid #e5e7eb;"
                                        th:text="${addr.zipCode}"></td>

                                    <td style="padding:10px; border-bottom:1px solid #e5e7eb;">
                                        <span style="padding:3px 8px; border-radius:999px; font-size:12px;
                                                     background:#7fad39; color:#fff; font-weight:700;">
                                            기본
                                        </span>
                                    </td>

                                    <td style="padding:10px; border-bottom:1px solid #e5e7eb;"
                                        th:text="${addr.detailAddress}"></td>

                                    <td style="padding:10px; border-bottom:1px solid #e5e7eb;">
                                        <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                            <a class="site-btn"
                                               style="background:#6f6f6f; padding:8px 12px;"
                                               th:href="@{/mypage/{username}/address/{id}/edit(
                                                    username=${username},
                                                    id=${addr.id},
                                                    label=${addr.label},
                                                    roadNameAddress=${addr.roadNameAddress},
                                                    zipCode=${addr.zipCode},
                                                    isDefault=${addr.isDefault},
                                                    detailAddress=${addr.detailAddress}
                                               )}">
                                                수정
                                            </a>

                                            <form th:action="@{|/mypage/${username}/address/${addr.id}/delete|}"
                                                  method="post"
                                                  onsubmit="return confirm('정말 삭제하시겠어요?');">
                                                <button class="site-btn"
                                                        type="submit"
                                                        style="background:#dc3545; padding:8px 12px;">
                                                    삭제
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>

                                <!-- ② 일반 주소 -->
                                <tr th:each="addr : ${addresses}"
                                    th:if="${!addr.isDefault}"
                                    style="transition: background .15s ease;"
                                    onmouseover="this.style.background='#f9fafb'"
                                    onmouseout="this.style.background=''">

                                    <td style="padding:10px; border-bottom:1px solid #e5e7eb;"
                                        th:text="${addr.label}"></td>

                                    <td style="padding:10px; border-bottom:1px solid #e5e7eb;"
                                        th:text="${addr.roadNameAddress}"></td>

                                    <td style="padding:10px; border-bottom:1px solid #e5e7eb;"
                                        th:text="${addr.zipCode}"></td>

                                    <td style="padding:10px; border-bottom:1px solid #e5e7eb;">
                                        <span style="color:#6f6f6f;">-</span>
                                    </td>

                                    <td style="padding:10px; border-bottom:1px solid #e5e7eb;"
                                        th:text="${addr.detailAddress}"></td>

                                    <td style="padding:10px; border-bottom:1px solid #e5e7eb;">
                                        <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                            <a class="site-btn"
                                               style="background:#6f6f6f; padding:8px 12px;"
                                               th:href="@{/mypage/{username}/address/{id}/edit(
                                                    username=${username},
                                                    id=${addr.id},
                                                    label=${addr.label},
                                                    roadNameAddress=${addr.roadNameAddress},
                                                    zipCode=${addr.zipCode},
                                                    isDefault=${addr.isDefault},
                                                    detailAddress=${addr.detailAddress}
                                               )}">
                                                수정
                                            </a>

                                            <form th:action="@{|/mypage/${username}/address/${addr.id}/delete|}"
                                                  method="post"
                                                  onsubmit="return confirm('정말 삭제하시겠어요?');">
                                                <button class="site-btn"
                                                        type="submit"
                                                        style="background:#dc3545; padding:8px 12px;">
                                                    삭제
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>

                                </tbody>
                            </table>

                        </div> <!-- 테이블 끝 -->

                    </div> <!-- 카드 끝 -->

                </div>
            </div>
        </div>
    </section>
</div>

<th:block layout:fragment="extra-js"></th:block>
</body>
</html>
