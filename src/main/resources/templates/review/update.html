<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <meta charset="UTF-8">
    <title>리뷰 수정 | 북스캠프</title>

    <style>
        .review-box {
            background: #fff;
            padding: 25px;
            border: 1px solid #ebebeb;
            border-radius: 6px;
            margin-top: 30px;
        }

        /* ⭐ 별점 스타일 */
        .stars .star {
            font-size: 32px;
            color: #ccc;
            cursor: pointer;
            transition: color 0.2s;
        }

        .stars .star.selected {
            color: #ffcc00;
        }

        .img-preview {
            max-width: 120px;
            margin-right: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
    </style>
</head>

<body>
<section layout:fragment="content">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 offset-lg-2 review-box">

                <h4 style="font-weight:700; margin-bottom:25px;">리뷰 수정</h4>

                <form th:action="@{/mypage/reviews}" method="post" enctype="multipart/form-data">

                    <input type="hidden" name="_method" value="put">
                    <input type="hidden" name="reviewId" th:value="${review.reviewId}">

                    <!-- ⭐ 평점 -->
                    <div style="margin-bottom:20px;">
                        <label style="font-weight:600;">평점</label>

                        <div class="stars">
                            <i class="fa fa-star star" data-value="1"></i>
                            <i class="fa fa-star star" data-value="2"></i>
                            <i class="fa fa-star star" data-value="3"></i>
                            <i class="fa fa-star star" data-value="4"></i>
                            <i class="fa fa-star star" data-value="5"></i>
                        </div>
                        <input type="hidden" name="score" id="scoreInput" th:value="${review.score}">
                    </div>

                    <!-- 내용 -->
                    <div style="margin-bottom:20px;">
                        <label style="font-weight:600;">리뷰 내용</label>
                        <textarea name="content"
                                  style="width:100%; height:140px; border:1px solid #ccc; padding:12px; border-radius:4px;"
                                  th:text="${review.content}"></textarea>
                    </div>

                    <!-- 기존 이미지 목록 -->
                    <div style="margin-bottom:20px;">
                        <label style="font-weight:600;">등록된 이미지</label><br>

                        <div th:each="img : ${review.imageUrls}" style="display:inline-block; margin-right:10px;">
                            <img th:src="${img}" class="img-preview">
                            <br>
                            <input type="checkbox" name="removedImageUrls" th:value="${img}">
                            삭제하기
                        </div>
                    </div>

                    <!-- 새 이미지 추가 -->
                    <div style="margin-bottom:20px;">
                        <label style="font-weight:600;">새 이미지 추가</label>
                        <input type="file" name="files" multiple class="form-control">
                    </div>

                    <button type="submit" class="site-btn" style="width:100%; margin-top:15px;">
                        변경 내용 저장
                    </button>

                </form>
            </div>
        </div>
    </div>
</section>

<!-- ⭐ 별점 스크립트 (기존 점수 적용) -->
<th:block layout:fragment="extra-js">
    <script th:inline="javascript">
        document.addEventListener("DOMContentLoaded", function () {
            const stars = document.querySelectorAll(".star");
            const scoreInput = document.getElementById("scoreInput");
            let currentScore = /*[[${review.score}]]*/ 0;

            // 기존 점수 채우기
            stars.forEach(s => {
                if (s.getAttribute("data-value") <= currentScore) {
                    s.classList.add("selected");
                }
            });

            // 클릭 시 재선택 가능
            stars.forEach(star => {
                star.addEventListener("click", function () {
                    const rating = this.getAttribute("data-value");
                    scoreInput.value = rating;

                    stars.forEach(s => {
                        s.classList.remove("selected");
                        if (s.getAttribute("data-value") <= rating) {
                            s.classList.add("selected");
                        }
                    });
                });
            });
        });
    </script>
</th:block>

</body>
</html>
